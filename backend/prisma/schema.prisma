generator client {
  provider     = "prisma-client"
  output       = "../generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  CUSTOMER
  ADMIN
}

enum OrderStatus {
  PENDING
  PAID
  FAILED
}

model User {
  id                 Int     @id @default(autoincrement())
  email              String  @unique
  hash               String
  cart               Cart?
  orders             Order[]
  role               Role    @default(CUSTOMER)
  hashedRefreshToken String?

  @@map("user")
}

model Product {
  id              Int         @id @default(autoincrement())
  name            String
  price           Int
  description     String
  light           String
  water           String
  temperature     String
  stock           Int         @default(0)
  cartItem        CartItem[]
  orderItem       OrderItem[]
  isDeleted       Boolean     @default(false)
  deletedAt       DateTime?
  keyName         String
  version         Int         @default(0)
  stripeProductId String
  stripePriceId   String
  height          Int
  width           Int

  @@map("product")
}

model CartItem {
  id        Int     @id @default(autoincrement())
  product   Product @relation(fields: [productId], references: [id])
  productId Int
  quantity  Int     @default(1)
  cart      Cart    @relation(fields: [cartId], references: [id])
  cartId    Int

  @@unique([productId, cartId])
  @@map("cartItem")
}

model Cart {
  id       Int        @id @default(autoincrement())
  user     User       @relation(fields: [userId], references: [id])
  userId   Int        @unique
  cartItem CartItem[]

  @@map("cart")
}

model OrderItem {
  id        Int     @id @default(autoincrement())
  product   Product @relation(fields: [productId], references: [id])
  productId Int
  quantity  Int
  price     Int
  order     Order   @relation(fields: [orderId], references: [id])
  orderId   Int

  @@map("orderItem")
}

model Order {
  id              Int         @id @default(autoincrement())
  user            User        @relation(fields: [userId], references: [id])
  userId          Int
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  orderItems      OrderItem[]
  orderStatus     OrderStatus @default(PENDING)
  stripeSessionId String?     @unique
  cartItems       Int[]

  @@map("order")
}
